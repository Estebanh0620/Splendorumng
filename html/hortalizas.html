<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hortalizas frescas – Splendor Herbs</title>
  <link rel="stylesheet" href="../css/styles.css"/>

  <style>
    :root{
      --verde-oscuro:#305730;
      --verde-medio:#4f8f3f;
      --texto-secundario:#555;
      --borde-suave:#dde7d6;
    }

    body{
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:radial-gradient(circle at top left,#e7f3de,#f6f9f2 50%,#ffffff 100%);
      color:#222;
    }

    .hero__overlay.centered{
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      background:rgba(0,0,0,.35);
    }
    .hero__overlay.centered h1{
      margin:0;
      max-width:900px;
      font-size:3.2rem;
      font-weight:800;
      color:#fff;
      text-shadow:0 3px 6px rgba(0,0,0,.4);
    }

    .catalogo{
      width:min(1200px,94%);
      margin:26px auto 10px;
    }
    .catalogo__intro{
      margin-bottom:16px;
      color:var(--texto-secundario);
      font-size:.95rem;
    }
    .catalogo__intro h2{
      margin-bottom:6px;
      color:var(--verde-oscuro);
      font-size:1.3rem;
    }

    .tiles{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(150px,1fr));
      gap:14px;
    }
    .tile{
      position:relative;
      border-radius:16px;
      overflow:hidden;
      background:#fff;
      cursor:pointer;
      box-shadow:0 6px 15px rgba(0,0,0,.06);
      border:1px solid rgba(217,232,207,0.9);
      transition:transform .12s ease, box-shadow .12s ease;
    }
    .tile:hover{
      transform:translateY(-3px);
      box-shadow:0 10px 22px rgba(0,0,0,.09);
    }
    .tile img{
      width:100%;
      height:130px;
      object-fit:cover;
      display:block;
    }
    .tile__label{
      padding:8px 10px 9px;
      text-align:center;
      font-weight:600;
      font-size:.9rem;
      color:var(--verde-oscuro);
      background:linear-gradient(90deg,#f7fbf3,#e8f5dd);
    }

    .results{
      width:min(1200px,94%);
      margin:18px auto 60px;
      min-height:80px;
    }
    .empty{
      text-align:center;
      font-size:.9rem;
      color:#777;
      padding:14px 12px;
      border-radius:12px;
      background:rgba(255,255,255,.85);
      border:1px dashed #d0e3c4;
    }

    .card{
      position:relative;
      display:grid;
      grid-template-columns:260px minmax(0,1fr);
      gap:0;
      border-radius:20px;
      overflow:hidden;
      background:linear-gradient(145deg,#ffffff,#f5f9f1);
      border:1px solid var(--borde-suave);
      box-shadow:0 14px 30px rgba(0,0,0,.08);
      animation:pop .18s ease-out;
    }
    .card__img{
      width:100%;
      height:100%;
      max-height:260px;
      object-fit:cover;
      display:block;
    }
    .card__body{
      padding:16px 18px 18px;
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .card__title{
      color:var(--verde-oscuro);
      font-weight:700;
      margin:0 0 6px;
      font-size:1.2rem;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .badge{
      height:10px;
      width:10px;
      border-radius:999px;
      background:linear-gradient(135deg,#4f8f3f,#8fd86f);
      display:inline-block;
    }
    .meta{
      margin-top:6px;
      font-size:.94rem;
      color:var(--texto-secundario);
      line-height:1.6;
    }
    .meta b{
      color:var(--verde-medio);
    }
    .card__close{
      position:absolute;
      top:10px;
      right:10px;
      width:32px;
      height:32px;
      line-height:30px;
      text-align:center;
      border-radius:999px;
      border:1px solid var(--verde-medio);
      background:#fff;
      color:var(--verde-medio);
      font-weight:800;
      cursor:pointer;
      user-select:none;
      box-shadow:0 4px 10px rgba(0,0,0,.08);
    }
    .card__close:hover{
      background:var(--verde-medio);
      color:#fff;
    }

    @keyframes pop{
      from{ transform:scale(.98); opacity:.8; }
      to{ transform:scale(1); opacity:1; }
    }

    @media(max-width:920px){
      .card{
        grid-template-columns:1fr;
      }
      .card__img{
        max-height:220px;
      }
      .hero__overlay.centered h1{
        font-size:2.3rem;
      }
    }
  </style>
</head>
<body>
  <!-- Header dinámico -->
  <div id="header"></div>

  <main class="main-content">
    <!-- HERO -->
    <section class="hero hero--cover">
      <img src="/Splendorumng/img/hortalizasfrescas.jpg" alt="Hortalizas frescas"/>
      <div class="hero__overlay centered">
        <h1>Hortalizas frescas</h1>
      </div>
    </section>

    <!-- Catálogo de tiles -->
    <section class="catalogo">
      <div class="catalogo__intro">
        <h2>Selecciona una hortaliza para ver su ficha técnica</h2>
        <p>
          Haz clic sobre cualquiera de las hortalizas frescas para ver su ficha con variedad,
          origen, empaque y recomendaciones de almacenamiento.
        </p>
      </div>

      <div class="tiles" id="tiles">
        <!-- Tiles generados por JS -->
      </div>
    </section>

    <!-- Ficha seleccionada -->
    <section class="results" id="results">
      <p class="empty">Haz clic en una hortaliza para ver su ficha.</p>
    </section>
  </main>

  <!-- Footer dinámico -->
  <div id="footer"></div>

  <!-- Cargar header/footer + menú -->
  <script>
    async function loadHTML(id, file, callback){
      const res = await fetch(file);
      const text = await res.text();
      document.getElementById(id).innerHTML = text;
      if (callback) callback();
    }

    loadHTML('header', 'header.html', () => {
      const script = document.createElement('script');
      script.src = '../js/menus.js';
      document.body.appendChild(script);
    });

    loadHTML('footer', 'footer.html');
  </script>

  <!-- Interacción fichas + conexión con admin -->
  <script>
    const FICHAS_DEFAULT = [
      {
        categoria: "Hortalizas frescas",
        nombre: "Lechuga",
        descripcion: "Hortaliza de hojas verdes y crujientes, baja en calorías y base esencial de ensaladas frescas.",
        variedad: "Crespa",
        origen: "Cundinamarca, Colombia",
        empaque: "12 / 18 / 20 unidades por caja",
        temperatura: "32°F - 36°F (0°C – 2°C)"
      },
      {
        categoria: "Hortalizas frescas",
        nombre: "Cebollin",
        descripcion: "De sabor suave a cebolla, se utiliza para sopas, ensaladas y como guarnición en diversos platos.",
        variedad: "Verdeo",
        origen: "Cundinamarca, Colombia",
        empaque: "10 a 12 rollos por caja",
        temperatura: "32°F - 41°F (0°C – 5°C)"
      },
      {
        categoria: "Hortalizas frescas",
        nombre: "Cilantro",
        descripcion: "Hierba de sabor fuerte y fresco, usada en salsas, sopas y cocina tradicional latinoamericana.",
        variedad: "Común",
        origen: "Tolima / Santander, Colombia",
        empaque: "14 a 16 lb por caja",
        temperatura: "32°F - 41°F (0°C – 5°C)"
      },
      {
        categoria: "Hortalizas frescas",
        nombre: "Perejil",
        descripcion: "Planta de hojas verdes, muy nutritiva, empleada como condimento, en guarniciones y jugos verdes.",
        variedad: "Liso",
        origen: "Valle del Cauca / Antioquia, Colombia",
        empaque: "14 a 16 lb por caja",
        temperatura: "32°F - 41°F (0°C – 5°C)"
      }
    ];

    function cargarFichas() {
      const guardadas = localStorage.getItem("fichasProductos");
      if (guardadas) {
        try {
          return JSON.parse(guardadas);
        } catch (e) {
          console.error("Error leyendo fichasProductos, usando default hortalizas.", e);
        }
      }
      return FICHAS_DEFAULT;
    }

    const fichas = cargarFichas().filter(f => f.categoria === "Hortalizas frescas");

    const tiles   = document.getElementById('tiles');
    const results = document.getElementById('results');

    function showEmpty(){
      results.innerHTML = '<p class="empty">Haz clic en una hortaliza para ver su ficha.</p>';
    }
    
    function crearTile(ficha) {
      const tile = document.createElement('div');
      tile.className = 'tile';
      tile.dataset.nombre = ficha.nombre;
      
      const baseLocal = '/Splendorumng/img/' + ficha.nombre;
      const srcMain = ficha.imagenUrl || baseLocal + '.jpg';
      const onErrorAttr = ficha.imagenUrl
      ? ''  // si viene de Firebase, no hacemos fallback
      : `onerror="this.onerror=null;this.src='${baseLocal}.png'"`;
      
      tile.innerHTML = `
      <img src="${srcMain}" ${onErrorAttr} alt="${ficha.nombre}">
      <div class="tile__label">${ficha.nombre}</div>
      `;
      return tile;
}

function createCard(ficha){
  const baseLocal = '/Splendorumng/img/' + ficha.nombre;
  const srcMain = ficha.imagenUrl || baseLocal + '.jpg';
  const onErrorAttr = ficha.imagenUrl
  ? ''
  : `onerror="this.onerror=null;this.src='${baseLocal}.png'"`;
  
  const card = document.createElement('article');
  card.className = 'card';
  card.innerHTML = `
    <button class="card__close" aria-label="Cerrar ${ficha.nombre}">✕</button>
    <img class="card__img" src="${srcMain}" ${onErrorAttr} alt="${ficha.nombre}">
    <div class="card__body">
      <h3 class="card__title"><span class="badge"></span> ${ficha.nombre}</h3>
      <p class="meta">${ficha.descripcion}</p>
      <p class="meta"><b>Variedad:</b> ${ficha.variedad}</p>
      <p class="meta"><b>Origen:</b> ${ficha.origen}</p>
      <p class="meta"><b>Empaque:</b> ${ficha.empaque}</p>
      <p class="meta"><b>Temperatura de almacenamiento:</b> ${ficha.temperatura}</p>
    </div>
    `;
    return card;
}


    // Pintar tiles
    if (fichas.length === 0) {
      tiles.innerHTML = '<p class="empty">No hay hortalizas configuradas en el panel de administración.</p>';
    } else {
      fichas.forEach(f => tiles.appendChild(crearTile(f)));
    }

    // Clic en tile → muestra ficha
    tiles.addEventListener('click',(e)=>{
      const tile = e.target.closest('.tile');
      if(!tile) return;
      const nombre = tile.dataset.nombre;
      const ficha = fichas.find(f => f.nombre === nombre);
      if (!ficha) return;

      results.innerHTML = '';
      const card = createCard(ficha);
      results.appendChild(card);
      card.scrollIntoView({behavior:'smooth', block:'center'});
    });

    // Cerrar ficha
    results.addEventListener('click',(e)=>{
      if(e.target.matches('.card__close')) showEmpty();
    });

    // Cerrar clic fuera
    document.addEventListener('click',(e)=>{
      const card = results.querySelector('.card');
      if(!card) return;
      const clickedInsideCard = e.composedPath().includes(card);
      const clickedTile = e.target.closest('.tile');
      if(!clickedInsideCard && !clickedTile) showEmpty();
    });

    showEmpty();
  </script>
</body>
</html>
